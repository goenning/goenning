<!DOCTYPE html>
<html lang="pt">
  <head>
    <title>Cache no Servidor com Go ‚Äì @goenning</title>

    <meta charset="utf-8" />
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" type="text/css" href="/style.css" />  <!-- Icons -->
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="alternate" type="application/rss+xml" title="@goenning - loop at { run; code; blog; swim; eat; cycle; } until tired;" href="/feed.xml" />
    

    <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Cache no Servidor com Go | @goenning</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Cache no Servidor com Go" />
<meta name="author" content="@goenning" />
<meta property="og:locale" content="pt" />
<meta name="description" content="Go √© muito r√°pido e todos n√≥s sabemos disto. Mas como fazemos para nossas aplica√ß√µes web serem ainda mais r√°pidas? Neste post vou mostrar como podemos obter tempos de resposta ainda menores using cache no lado do servidor, afinal, performance √© importante e ningu√©m gosta de ficar olhando barra de progresso, n√£o √©?" />
<meta property="og:description" content="Go √© muito r√°pido e todos n√≥s sabemos disto. Mas como fazemos para nossas aplica√ß√µes web serem ainda mais r√°pidas? Neste post vou mostrar como podemos obter tempos de resposta ainda menores using cache no lado do servidor, afinal, performance √© importante e ningu√©m gosta de ficar olhando barra de progresso, n√£o √©?" />
<link rel="canonical" href="https://goenning.net/2017/03/18/cache-no-servidor-com-go/" />
<meta property="og:url" content="https://goenning.net/2017/03/18/cache-no-servidor-com-go/" />
<meta property="og:site_name" content="@goenning" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-03-18T00:00:00-05:00" />
<script type="application/ld+json">
{"headline":"Cache no Servidor com Go","dateModified":"2017-03-18T00:00:00-05:00","datePublished":"2017-03-18T00:00:00-05:00","url":"https://goenning.net/2017/03/18/cache-no-servidor-com-go/","author":{"@type":"Person","name":"@goenning"},"description":"Go √© muito r√°pido e todos n√≥s sabemos disto. Mas como fazemos para nossas aplica√ß√µes web serem ainda mais r√°pidas? Neste post vou mostrar como podemos obter tempos de resposta ainda menores using cache no lado do servidor, afinal, performance √© importante e ningu√©m gosta de ficar olhando barra de progresso, n√£o √©?","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://goenning.net/2017/03/18/cache-no-servidor-com-go/"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>
    <div class="wrapper-masthead">
      <div class="container">
        <header class="masthead clearfix">
          <a href="/pt" class="site-avatar"><img width="70" height="70" alt="@goenning" src="https://avatars.githubusercontent.com/u/94755?s=210" /></a>

          <div class="site-info">
            <h1 class="site-name"><a href="/pt">@goenning</a></h1>
            <p class="site-description">loop at { run; code; blog; swim; eat; cycle; } until tired;</p>
          </div>

          <nav>
            
              <a href="/pt">Blog</a>
            
              <a href="/arquivo">Arquivo</a>
            
              <a href="/projetos">Projetos</a>
            

            <div class="langs">
              
              
              
              
              
              <a href="/2017/03/18/cache-no-servidor-com-go/" title="Portugu√™s" class="flag">
                <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 480" height="100%" width="100%">
  <g stroke-width="1pt">
    <path fill-rule="evenodd" fill="#229e45" d="M0 0h640v480H0z"/>
    <path d="M321.406 435.935l301.483-195.67-303.308-196.2L17.11 240.734l304.296 195.2z" fill-rule="evenodd" fill="#f8e509"/>
    <path d="M452.77 240.005c0 70.328-57.103 127.34-127.544 127.34-70.442 0-127.544-57.012-127.544-127.34s57.104-127.34 127.544-127.34c70.442 0 127.545 57.012 127.545 127.34z" fill-rule="evenodd" fill="#2b49a3"/>
    <path fill="#ffffef" fill-rule="evenodd" d="M283.3 316.274L279.357 314l-4.093 2.025.917-4.55-3.162-3.332 4.52-.53 2.124-4.08 1.894 4.22 4.46.81-3.345 3.13M368.77 337.917l-3.94-2.274-4.092 2.025.916-4.55-3.16-3.332 4.52-.53 2.122-4.08 1.894 4.22 4.46.81-3.345 3.13M331.93 303.343l-3.404-1.964-3.536 1.748.792-3.93-2.73-2.88 3.904-.457 1.834-3.523 1.636 3.645 3.853.7-2.89 2.705M418.254 290.91l-3.342-1.928-3.472 1.718.777-3.858-2.68-2.827 3.833-.45 1.8-3.46 1.607 3.58 3.783.686-2.837 2.657M330.37 265.03l-3.94-2.273-4.093 2.025.916-4.55-3.162-3.332 4.522-.53 2.123-4.08 1.894 4.22 4.46.81-3.346 3.13M225.13 225.52l-3.94-2.274-4.094 2.025.916-4.548-3.16-3.333 4.52-.53 2.122-4.08 1.894 4.22 4.46.81-3.345 3.13M237.786 278.08l-3.94-2.275-4.094 2.025.916-4.548-3.16-3.334 4.52-.53 2.123-4.08 1.894 4.22 4.46.81-3.345 3.132M369.114 206.17l-3.48-2.007-3.616 1.788.81-4.017-2.794-2.944 3.994-.47 1.875-3.603 1.673 3.728 3.94.715-2.955 2.766M361.896 240.366l-2.74-1.582-2.85 1.408.64-3.164-2.2-2.32 3.145-.368 1.477-2.838 1.318 2.936 3.103.563-2.327 2.18M219.263 287.603l-2.63-1.518-2.734 1.352.61-3.037-2.11-2.225 3.02-.354 1.416-2.723 1.264 2.818 2.978.54-2.233 2.09M418.984 299.71l-2.144-1.135-2.227 1.01.5-2.27-1.72-1.666 2.46-.265 1.154-2.038 1.03 2.108 2.426.404-1.82 1.563"/>
    <path fill="#ffffef" fill-rule="evenodd" d="M219.263 287.603l-2.63-1.518-2.734 1.352.61-3.037-2.11-2.225 3.02-.354 1.416-2.723 1.264 2.818 2.978.54-2.233 2.09"/>
    <path fill="#ffffef" fill-rule="evenodd" d="M219.263 287.603l-2.63-1.518-2.734 1.352.61-3.037-2.11-2.225 3.02-.354 1.416-2.723 1.264 2.818 2.978.54-2.233 2.09M261.143 287.594l-2.63-1.52-2.733 1.353.61-3.037-2.11-2.225 3.02-.354 1.416-2.722 1.265 2.817 2.978.54-2.233 2.09M255.94 301.525l-2.63-1.518-2.734 1.352.612-3.038-2.11-2.225 3.017-.354 1.417-2.724 1.265 2.817 2.977.54-2.233 2.09M342.902 276.164l-2.63-1.52-2.733 1.353.61-3.036-2.11-2.225 3.018-.353 1.417-2.724 1.265 2.817 2.977.54-2.233 2.09M317.384 276.154l-2.63-1.518-2.734 1.352.612-3.037-2.11-2.225 3.018-.353 1.417-2.724 1.264 2.817 2.98.54-2.234 2.09M248.167 267.258l-1.648-.952-1.714.847.384-1.902-1.323-1.394 1.89-.222.89-1.706.792 1.765 1.864.34-1.4 1.31M415.74 310.728l-2.63-1.518-2.733 1.35.612-3.035-2.11-2.226 3.017-.354 1.417-2.724 1.264 2.817 2.978.54-2.233 2.09M394.49 313.512l-2.178-1.26-2.264 1.122.507-2.522-1.748-1.848 2.5-.294 1.174-2.262 1.048 2.34 2.466.45-1.85 1.735M404.516 313.27l-2.03-1.173-2.108 1.044.472-2.344-1.63-1.718 2.33-.274 1.093-2.103.976 2.177 2.296.417-1.723 1.615M433.302 288.15l-1.955-1.13-2.03 1.006.454-2.257-1.567-1.655 2.243-.262 1.053-2.024.94 2.092 2.21.402-1.658 1.553M394.24 327.69l-2.554-1.395-2.652 1.24.594-2.786-2.05-2.043 2.93-.325 1.376-2.5 1.227 2.586 2.89.496-2.167 1.92M394.383 339.13l-2.33-1.395-2.418 1.24.542-2.786-1.87-2.044 2.673-.324 1.255-2.5 1.12 2.586 2.635.496-1.977 1.918M375.084 313.266l-1.955-1.13-2.032 1.006.455-2.257-1.568-1.653 2.242-.263 1.054-2.025.94 2.093 2.213.402-1.66 1.554M356.992 313.266l-1.954-1.13-2.03 1.006.454-2.257-1.57-1.653 2.244-.263 1.053-2.025.94 2.093 2.21.402-1.658 1.554M326.273 286.403l-1.955-1.128-2.03 1.004.454-2.257-1.568-1.654 2.243-.264 1.053-2.024.94 2.094 2.212.402-1.66 1.553M329.696 341.153l-1.656-.956-1.72.85.386-1.91-1.33-1.4 1.9-.223.893-1.715.795 1.772 1.874.34-1.407 1.316M283.3 252.597l-3.942-2.274-4.093 2.025.917-4.548-3.162-3.334 4.52-.53 2.124-4.08 1.894 4.22 4.46.81-3.345 3.132"/>
    <path d="M444.368 285.817c1.944-5.083 4.45-12.75 5.783-19.786-67.742-59.508-143.26-89.993-238.68-83.72-3.422 6.558-6.16 13.423-8.47 20.853 113.063-10.786 195.936 39.27 241.37 82.654z" fill-rule="evenodd" fill="#fff"/>
    <path d="M413.914 252.36l2.42 1.323c-.38.858-.48 1.61-.31 2.25.18.645.625 1.208 1.335 1.688.75.515 1.424.74 2.016.68.6-.06 1.045-.306 1.335-.734.183-.274.258-.563.225-.863-.027-.3-.192-.66-.495-1.075-.21-.28-.72-.873-1.53-1.777-1.04-1.16-1.66-2.138-1.86-2.936-.28-1.122-.11-2.14.51-3.06.4-.59.936-1.03 1.612-1.318.686-.29 1.433-.355 2.24-.198.81.157 1.664.54 2.55 1.143 1.453.987 2.33 2.048 2.63 3.184.305 1.138.117 2.253-.565 3.345l-2.404-1.484c.3-.665.375-1.24.218-1.723-.147-.485-.55-.95-1.21-1.397-.676-.46-1.302-.682-1.874-.663-.37.01-.654.168-.856.468-.186.277-.228.59-.13.943.13.45.668 1.193 1.625 2.234.953 1.04 1.604 1.89 1.95 2.547.355.657.516 1.34.482 2.05-.023.706-.284 1.427-.778 2.16-.45.667-1.053 1.163-1.812 1.493-.76.33-1.57.412-2.437.24-.86-.177-1.794-.607-2.798-1.29-1.462-.992-2.36-2.093-2.687-3.3-.322-1.213-.125-2.523.6-3.925zM402.436 244.827l2.472 1.22c-.345.872-.417 1.628-.22 2.26.208.637.672 1.183 1.4 1.635.775.482 1.455.68 2.043.596.6-.086 1.037-.346 1.306-.786.174-.28.236-.573.19-.87-.038-.302-.218-.655-.54-1.058-.22-.272-.75-.84-1.597-1.713-1.087-1.117-1.746-2.07-1.978-2.86-.323-1.11-.194-2.133.385-3.077.378-.606.896-1.066 1.56-1.38.674-.316 1.42-.413 2.23-.29.818.127 1.685.473 2.595 1.04 1.492.926 2.408 1.952 2.753 3.074.35 1.126.21 2.247-.427 3.365l-2.464-1.385c.275-.676.327-1.252.15-1.728-.168-.482-.59-.93-1.264-1.35-.697-.433-1.33-.628-1.9-.586-.37.025-.647.195-.838.504-.172.282-.204.594-.09.944.145.443.714 1.165 1.71 2.168.994 1 1.68 1.822 2.052 2.465.38.64.568 1.318.563 2.027.007.708-.227 1.437-.69 2.193-.42.68-1.008 1.202-1.75 1.565-.746.36-1.556.474-2.427.336-.865-.14-1.815-.536-2.848-1.175-1.498-.933-2.438-1.996-2.815-3.19-.374-1.2-.23-2.514.438-3.943zM388.23 241.02l7.276-11.966 8.837 5.416-1.23 2.026-6.43-3.942-1.615 2.652 5.983 3.668-1.225 2.015-5.984-3.667-1.977 3.256 6.657 4.08-1.228 2.017-9.063-5.557zM367.538 224.027l1.08-2.1 5.4 2.796-2.546 4.962c-.79.238-1.78.296-2.982.17-1.19-.13-2.295-.457-3.317-.986-1.3-.673-2.29-1.528-2.976-2.572-.683-1.05-1.01-2.205-.974-3.47.04-1.274.363-2.507.977-3.703.664-1.298 1.53-2.31 2.59-3.04 1.057-.727 2.25-1.09 3.57-1.09 1.008-.002 2.104.306 3.29.916 1.542.8 2.577 1.747 3.104 2.846.54 1.096.638 2.28.298 3.555l-2.728-.82c.14-.702.057-1.356-.25-1.957-.296-.606-.806-1.095-1.527-1.47-1.097-.567-2.146-.67-3.155-.305-1 .363-1.85 1.23-2.554 2.6-.76 1.48-1.005 2.76-.73 3.842.277 1.073.944 1.886 2.008 2.437.524.27 1.1.44 1.73.507.64.066 1.22.05 1.753-.05l.81-1.582-2.872-1.485zM277.296 201.648l2.034-13.867 4.172.62 1.123 9.826 3.86-9.093 4.188.618-2.033 13.87-2.59-.382 1.6-10.918-4.343 10.512-2.685-.398-1.134-11.32-1.6 10.915-2.592-.382zM263.188 200.01l1.305-13.96 10.307.974-.217 2.36-7.503-.706-.29 3.095 6.978.657-.22 2.352-6.98-.658-.353 3.8 7.764.73-.22 2.354-10.572-.998z" fill="#309e3a"/>
    <g stroke-opacity=".502">
      <path d="M216.5 191.28c.04-1.43.284-2.62.736-3.58.335-.703.786-1.332 1.346-1.884.566-.552 1.18-.956 1.844-1.21.88-.347 1.888-.505 3.023-.475 2.056.06 3.682.744 4.877 2.057 1.205 1.315 1.775 3.114 1.714 5.395-.06 2.26-.72 4.017-1.982 5.264-1.26 1.24-2.914 1.834-4.963 1.777-2.077-.056-3.708-.736-4.9-2.037-1.19-1.308-1.755-3.078-1.694-5.307z" fill="#309e3a"/>
      <path d="M219.414 191.252c-.043 1.586.29 2.8.997 3.643.708.837 1.625 1.27 2.748 1.3 1.122.03 2.055-.35 2.794-1.138.745-.797 1.14-2.007 1.184-3.633.043-1.605-.277-2.813-.96-3.622-.676-.81-1.595-1.23-2.757-1.262-1.162-.03-2.11.345-2.843 1.128-.733.777-1.12 1.972-1.163 3.584z" fill="#f7ffff"/>
    </g>
    <g stroke-opacity=".502">
      <path d="M233.052 198.51l.163-14.017 5.933.07c1.494.018 2.574.157 3.244.42.677.257 1.214.71 1.613 1.36s.593 1.385.584 2.215c-.013 1.052-.332 1.918-.956 2.598-.623.675-1.55 1.095-2.777 1.26.605.363 1.104.76 1.49 1.193.397.43.923 1.195 1.585 2.293l1.673 2.754-3.372-.04-2.002-3.074c-.71-1.098-1.198-1.788-1.46-2.072-.265-.29-.545-.487-.842-.593-.297-.11-.77-.17-1.418-.177l-.57-.008-.068 5.852-2.82-.033z" fill="#309e3a"/>
      <path d="M235.976 190.455l2.086.024c1.353.016 2.198-.03 2.536-.142.337-.112.603-.305.796-.584s.293-.627.3-1.048c.004-.472-.118-.853-.37-1.142-.243-.296-.594-.486-1.05-.567-.23-.034-.915-.06-2.057-.072l-2.2-.026-.04 3.555z" fill="#fff"/>
    </g>
    <g stroke-opacity=".502">
      <path d="M249.003 185.188l5.147.26c1.16.06 2.04.195 2.64.405.804.283 1.484.75 2.036 1.396.553.646.958 1.426 1.218 2.34.26.907.356 2.015.29 3.326-.058 1.153-.252 2.138-.58 2.96-.4 1-.938 1.797-1.618 2.396-.51.453-1.19.79-2.034 1.016-.632.166-1.468.222-2.51.17l-5.295-.27.706-14z" fill="#309e3a"/>
      <path d="M251.706 187.685l-.468 9.274 2.103.105c.786.042 1.357.025 1.71-.046.46-.093.85-.268 1.16-.526.32-.26.59-.695.81-1.31.223-.62.36-1.47.416-2.553s0-1.918-.16-2.507c-.16-.59-.404-1.053-.73-1.397-.327-.342-.75-.583-1.27-.724-.39-.11-1.157-.193-2.306-.25l-1.264-.067z" fill="#fff"/>
    </g>
    <g stroke-opacity=".502">
      <path d="M317.63 210.22l3.26-13.63 4.4 1.06c1.666.402 2.737.732 3.21.99.73.392 1.274.996 1.634 1.81.36.81.41 1.755.152 2.84-.2.836-.518 1.504-.958 2-.438.5-.932.854-1.48 1.07-.54.212-1.064.31-1.57.3-.685-.028-1.65-.19-2.89-.49l-1.786-.432-1.23 5.142-2.743-.66z" fill="#309e3a"/>
      <path d="M323.086 199.552l-.926 3.868 1.5.362c1.082.26 1.82.364 2.218.308.4-.055.736-.21 1.013-.464.283-.253.473-.58.568-.984.12-.496.073-.94-.14-1.33-.214-.395-.533-.684-.957-.87-.312-.143-.96-.332-1.95-.57l-1.324-.32z" fill="#fff"/>
    </g>
    <g stroke-opacity=".502">
      <path d="M330.606 214.106l4.64-13.22 5.598 1.98c1.408.498 2.387.98 2.937 1.445.56.463.923 1.064 1.093 1.807s.12 1.505-.156 2.286c-.348.992-.928 1.71-1.736 2.153-.806.438-1.817.537-3.032.298.457.54.802 1.076 1.03 1.61.238.536.49 1.43.765 2.683l.704 3.15-3.18-1.126-.913-3.556c-.322-1.27-.562-2.08-.72-2.435-.158-.36-.36-.638-.607-.834-.246-.202-.673-.41-1.286-.627l-.536-.192-1.938 5.52-2.66-.942z" fill="#309e3a"/>
      <path d="M335.938 207.426l1.967.695c1.276.452 2.09.68 2.445.683.355.005.67-.093.943-.295.272-.2.478-.5.616-.896.155-.445.162-.845.017-1.2-.135-.36-.408-.65-.813-.876-.206-.106-.847-.35-1.924-.73l-2.075-.736-1.177 3.356z" fill="#fff"/>
    </g>
    <g stroke-opacity=".502">
      <path d="M347.01 213.6c.424-1.363.982-2.444 1.673-3.24.517-.59 1.117-1.072 1.808-1.45.696-.377 1.397-.598 2.102-.665.94-.093 1.953.03 3.038.37 1.965.614 3.344 1.717 4.14 3.308.803 1.593.867 3.48.19 5.658-.67 2.162-1.78 3.67-3.33 4.528-1.548.852-3.302.97-5.26.357-1.982-.62-3.37-1.718-4.164-3.294-.793-1.583-.858-3.44-.196-5.57z" fill="#309e3a"/>
      <path d="M349.826 214.385c-.47 1.514-.48 2.773-.026 3.778.455.996 1.22 1.663 2.293 2 1.073.334 2.07.223 2.996-.336.932-.562 1.64-1.62 2.122-3.172.476-1.535.495-2.783.056-3.75-.432-.962-1.204-1.618-2.313-1.964-1.11-.347-2.123-.243-3.04.312-.915.548-1.61 1.592-2.09 3.133z" fill="#fff"/>
    </g>
    <g stroke-opacity=".502">
      <path d="M374.305 233.12l6.415-12.45 5.27 2.736c1.326.69 2.23 1.3 2.71 1.84.49.532.768 1.18.835 1.94s-.092 1.505-.47 2.242c-.48.934-1.153 1.564-2.017 1.892-.86.322-1.872.28-3.043-.128.378.598.645 1.18.8 1.74.158.564.288 1.484.387 2.763l.262 3.215-2.993-1.555-.415-3.648c-.145-1.304-.27-2.14-.378-2.512-.105-.377-.27-.682-.487-.91-.214-.233-.61-.5-1.186-.798l-.507-.264-2.677 5.197-2.505-1.3z" fill="#309e3a"/>
      <path d="M380.503 227.226l1.853.962c1.2.625 1.977.962 2.33 1.016.35.054.675 0 .973-.162.296-.16.54-.428.733-.803.216-.42.276-.814.184-1.186-.087-.374-.315-.702-.685-.98-.19-.134-.79-.465-1.808-.993l-1.952-1.013-1.63 3.16z" fill="#fff"/>
    </g>
    <g stroke-opacity=".502">
      <path d="M426.107 258.704c.797-1.183 1.642-2.056 2.536-2.62.662-.412 1.377-.7 2.146-.862.774-.16 1.507-.168 2.2-.028.93.184 1.864.596 2.805 1.235 1.704 1.156 2.708 2.612 3.014 4.366.31 1.758-.173 3.58-1.448 5.472-1.263 1.873-2.758 2.998-4.488 3.37-1.728.365-3.44-.028-5.14-1.182-1.718-1.168-2.732-2.622-3.04-4.362-.303-1.746.168-3.543 1.413-5.39z" fill="#309e3a"/>
      <path d="M428.578 260.254c-.886 1.316-1.256 2.518-1.112 3.61.15 1.087.69 1.945 1.62 2.578.932.632 1.92.815 2.967.55 1.055-.27 2.037-1.077 2.944-2.425.896-1.33 1.273-2.52 1.13-3.572-.138-1.047-.688-1.898-1.65-2.552s-1.962-.85-3-.583c-1.033.26-1.998 1.06-2.9 2.394z" fill="#fff"/>
    </g>
    <path d="M301.824 204.523l2.248-9.84 7.268 1.675-.378 1.662-5.287-1.217-.504 2.18 4.926 1.136-.382 1.655-4.918-1.132-.614 2.677 5.475 1.26-.378 1.66-7.456-1.717z" fill="#309e3a"/>
  </g>
</svg>

              </a>
              <a href="/2017/03/18/server-side-cache-go/" title="English" class="flag">
                <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 480" height="100%" width="100%">
  <defs>
    <clipPath id="a">
      <path fill-opacity=".67" d="M-85.333 0h682.67v512h-682.67z"/>
    </clipPath>
  </defs>
  <g clip-path="url(#a)" transform="matrix(.94 0 0 .94 80 0)">
    <g stroke-width="1pt">
      <path fill="#006" d="M-256 0H768.02v512.01H-256z"/>
      <path d="M-256 0v57.244l909.535 454.768H768.02V454.77L-141.515 0H-256zM768.02 0v57.243L-141.515 512.01H-256v-57.243L653.535 0H768.02z" fill="#fff"/>
      <path d="M170.675 0v512.01h170.67V0h-170.67zM-256 170.67v170.67H768.02V170.67H-256z" fill="#fff"/>
      <path d="M-256 204.804v102.402H768.02V204.804H-256zM204.81 0v512.01h102.4V0h-102.4zM-256 512.01L85.34 341.34h76.324l-341.34 170.67H-256zM-256 0L85.34 170.67H9.016L-256 38.164V0zm606.356 170.67L691.696 0h76.324L426.68 170.67h-76.324zM768.02 512.01L426.68 341.34h76.324L768.02 473.848v38.162z" fill="#c00"/>
    </g>
  </g>
</svg>

              </a>
            </div>
          </nav>
        </header>
      </div>
    </div>

    <div id="main" role="main" class="container">
      <article class="post">
  <h1>Cache no Servidor com Go</h1>

  <small>
    


  18 de
  Mar√ßo
      
  de 2017

    


  
    ‚Ä¢ 9 minutos para ler
  

    ‚Ä¢ 
  <a href="/tags/pt#go">go</a>,

  <a href="/tags/pt#web">web</a>,

  <a href="/tags/pt#performance">performance</a>,

  <a href="/tags/pt#cache">cache</a>

  </small>

  <div class="entry">
    <p><img src="/public/images/2017/03/server-side-cache-go.png" alt="" /></p>

<p>Go √© muito r√°pido e todos n√≥s sabemos disto. Mas como fazemos para nossas aplica√ß√µes web serem ainda mais r√°pidas?</p>

<p>Quando falamos em performance, as discuss√µes geralmente acabam em algum tipo de cache. Neste post vou mostrar como podemos obter tempos de resposta ainda menores using cache no lado do servidor, afinal, performance √© importante e ningu√©m gosta de ficar olhando barra de progresso, n√£o √©?</p>

<h2 id="o-que-√©-cache-no-lado-do-servidor">O que √© cache no lado do servidor?</h2>

<p>A maioria dos desenvolvedores web j√° est√° familizariado com o cache de navegador, aquele que usa o cabe√ßalho HTTP <code class="highlighter-rouge">Cache-Control</code>. Este par√¢metro que √© definido pelo servidor √© usado para informar ao navegador quando e por quanto tempo √© que ele pode fazer o cache da resposta HTTP. Isto √© extremamente importante a devemos sempre usar para arquivos est√°ticos como JavaScript, CSS e Imagens.</p>

<p>Mas e as p√°ginas HTML? Podemos fazer cache delas tamb√©m? Certamente n√£o √© recomend√°vel fazer isto no lado do navegador, afinal se o conte√∫do de nossa p√°gina for alterado, alguns visitantes continuariam a visualizar o conte√∫do antigo. Imagine um portal de not√≠cias como o G1 ou R7. Como eles podem oferecer um servi√ßo t√£o r√°pido para milh√µes de pessoas? Se um novo artigo for publicado, todos os visitantes devem podem visualizar imediatamente na pr√≥xima atualiza√ß√£o da p√°gina.</p>

<p>√â ai que entra o cache no lado do servidor. Montar a p√°gina inicial de um portal de not√≠cias √© uma opera√ß√£o que exige de bastante IO como chamadas ao banco de dados, leitura de arquivos ou chamadas √† API externas. Ap√≥s o HTML da p√°gina inicial √© montada para o primeiro visitante, √© poss√≠vel armazenar isto em cache e utilizar este mesmo HTML para todas as requisi√ß√µes subsequentes √† mesma p√°gina. Ao fazermos isto no servidor, temos total controle para invalidar o cache a qualquer momento.</p>

<p>Isto n√£o remove a necessidade de fazer uma requisi√ß√£o HTTP para a p√°gina HTML, mas certamente agiliza a forma como que o servidor responde.</p>

<h3 id="como-fazemos-isto-em-go">Como fazemos isto em Go?</h3>

<p>Go n√£o √© apenas r√°pido, √© tamb√©m muito f√°cil, ent√£o uma implementa√ß√£o simples requer apenas algunas linhas de c√≥digo.</p>

<p>A parte mais dif√≠cil √© decidir onde √© que voc√™ armazenar√° o cache. Os meios mais comuns s√£o: em mem√≥ria, disco ou banco de dados. Qualquer um destes funcionar√° muito bem, mas entender os pontos fortes e negativos de cada um √© muito importante antes de tomar uma decis√£o.</p>

<p><strong>Em mem√≥ria</strong>: Toda p√°gina √© armazenada na mem√≥ria do process que est√° hospedando a p√°gina. Isto faz com que o acesso seja o mais r√°pido poss√≠vel e tamb√©m o mais f√°cil de implementar. O grande ponto negativo √© que como o cache √© local, cada servidor ter√° sua pr√≥pria c√≥pia. Al√©m disto, caso o processo reinicie por qualquer motivo, o cache √© perdido e ter√° ser√° reconstruido assim que receber novas requisi√ß√µes.</p>

<p><strong>Disco</strong>: Toda p√°gina √© armazenada no disco, seja ele local ou remoto. Caso o disco seja remoto, certamente esta n√£o √© a op√ß√£o mais r√°pida j√° que haver√° um tr√°fego de rede a cada opera√ß√£o de escrita e leitura. A grande vantagem √© que √© barato e resiliente, j√° que o cache √© mantido quando a aplica√ß√£o √© reiniciada.</p>

<p><strong>Banco de Dados</strong>: As p√°ginas s√£o armazenadas em um banco de dados, pode ser SQL ou chave-valor (Redis, Memcached). O fato √© que Redis √© uma das op√ß√£o mais usadas para nesta situa√ß√£o. N√£o chega a ser t√£o r√°pido quanto o armazenamento em mem√≥ria, j√° que √© necess√°rio algumas opera√ß√µes na rede, mas o cache √© compartilhado por todos os servidores de aplica√ß√£o, ou seja, o √© resiliente e centralizado.</p>

<h3 id="eu-quero-ver-c√≥digo">Eu quero ver c√≥digo!</h3>

<p>O c√≥digo fonte complete desta aplica√ß√£o de demonstra√ß√£o est√° dispon√≠vel no <a href="https://github.com/goenning/go-cache-demo">GitHub</a>. A aplica√ß√£o est√° em execu√ß√£o no <a href="https://go-cache-demo.herokuapp.com/">Heroku</a> tamb√©m. Vou ressaltar aqui as partes importantes do c√≥digo.</p>

<p>O primeiro passo foi criar uma interface chamada de <a href="https://github.com/goenning/go-cache-demo/blob/master/cache/cache.go">Storage</a> que pode ser usada para ler ou escrever no cache. Isto √© uma interface, pois o consumidor n√£o deveria estar acoplado √† uma implementa√ß√£o espec√≠fica.</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span><span class="x"> </span><span class="n">Storage</span><span class="x"> </span><span class="k">interface</span><span class="x"> </span><span class="p">{</span><span class="x">
	</span><span class="n">Get</span><span class="p">(</span><span class="n">key</span><span class="x"> </span><span class="kt">string</span><span class="p">)</span><span class="x"> </span><span class="p">[]</span><span class="kt">byte</span><span class="x">
	</span><span class="n">Set</span><span class="p">(</span><span class="n">key</span><span class="x"> </span><span class="kt">string</span><span class="p">,</span><span class="x"> </span><span class="n">content</span><span class="x"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">,</span><span class="x"> </span><span class="n">duration</span><span class="x"> </span><span class="n">time</span><span class="o">.</span><span class="n">Duration</span><span class="p">)</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre></div></div>

<p>Em seguida temos duas structs que implementam esta interface, <a href="https://github.com/goenning/go-cache-demo/blob/master/cache/memory/cache.go">memory.Storage</a> que utiliza um objeto <code class="highlighter-rouge">map</code> para armazenar o cache e o <a href="https://github.com/goenning/go-cache-demo/blob/master/cache/redis/cache.go">redis.Storage</a> que utiliza um cliente de Redis.</p>

<p>A implementa√ß√£o destas structs √© simples de entender, ent√£o vou pular esta parte. Voc√™ pode tentar implementar um Storage para gravar o cache em disco. Apenas crie uma nova struct que implemente a interface e utilize o pacote <code class="highlighter-rouge">os</code> ou <code class="highlighter-rouge">ioutil</code> do Go para ler e escrever em arquivos.</p>

<p><code class="highlighter-rouge">cached</code> √© um middleware HTTP que √© executado antes do HTTP handler e retorna a p√°gina imediatamente caso ela j√° esteja no cache. Caso contr√°rio, o handler √© executado e a responsta √© armazenada no cache por algum tempo. Pelo fato desta func√£o ser um middleware, fica f√°cil habilitar/desabilitar o cache para p√°gina espec√≠ficas. Continue lendo para ver um exemplo.</p>

<p>Estou usando <code class="highlighter-rouge">RequestURI</code> como a chave do cache, pois o objetivo aqui √© fazer o cache utilizando a URL completa, incluindo o path e a querystring. Isto significa que as p√°ginas <code class="highlighter-rouge">/users?page=1</code> e <code class="highlighter-rouge">/users?page=2</code> s√£o armazenadas separadamente, mesmo que o HTTP handler seja o mesmo para ambas URL.</p>

<p>O c√≥digo do middleware √© o seguinte.</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span><span class="x"> </span><span class="n">main</span><span class="x">

</span><span class="k">import</span><span class="x"> </span><span class="p">(</span><span class="x">
	</span><span class="s">"fmt"</span><span class="x">
	</span><span class="s">"net/http"</span><span class="x">
	</span><span class="s">"net/http/httptest"</span><span class="x">
	</span><span class="s">"time"</span><span class="x">
</span><span class="p">)</span><span class="x">

</span><span class="k">func</span><span class="x"> </span><span class="n">cached</span><span class="p">(</span><span class="n">duration</span><span class="x"> </span><span class="kt">string</span><span class="p">,</span><span class="x"> </span><span class="n">handler</span><span class="x"> </span><span class="k">func</span><span class="p">(</span><span class="n">w</span><span class="x"> </span><span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span><span class="x"> </span><span class="n">r</span><span class="x"> </span><span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">))</span><span class="x"> </span><span class="n">http</span><span class="o">.</span><span class="n">Handler</span><span class="x"> </span><span class="p">{</span><span class="x">
	</span><span class="k">return</span><span class="x"> </span><span class="n">http</span><span class="o">.</span><span class="n">HandlerFunc</span><span class="p">(</span><span class="k">func</span><span class="p">(</span><span class="n">w</span><span class="x"> </span><span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span><span class="x"> </span><span class="n">r</span><span class="x"> </span><span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span><span class="x"> </span><span class="p">{</span><span class="x">

		</span><span class="n">content</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">storage</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">RequestURI</span><span class="p">)</span><span class="x">
		</span><span class="k">if</span><span class="x"> </span><span class="n">content</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
			</span><span class="n">fmt</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="s">"Cache Hit!</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span><span class="x">
			</span><span class="n">w</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span><span class="x">
		</span><span class="p">}</span><span class="x"> </span><span class="k">else</span><span class="x"> </span><span class="p">{</span><span class="x">
			</span><span class="n">c</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">httptest</span><span class="o">.</span><span class="n">NewRecorder</span><span class="p">()</span><span class="x">
			</span><span class="n">handler</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="x"> </span><span class="n">r</span><span class="p">)</span><span class="x">

			</span><span class="k">for</span><span class="x"> </span><span class="n">k</span><span class="p">,</span><span class="x"> </span><span class="n">v</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="k">range</span><span class="x"> </span><span class="n">c</span><span class="o">.</span><span class="n">HeaderMap</span><span class="x"> </span><span class="p">{</span><span class="x">
				</span><span class="n">w</span><span class="o">.</span><span class="n">Header</span><span class="p">()[</span><span class="n">k</span><span class="p">]</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="n">v</span><span class="x">
			</span><span class="p">}</span><span class="x">

			</span><span class="n">w</span><span class="o">.</span><span class="n">WriteHeader</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Code</span><span class="p">)</span><span class="x">
			</span><span class="n">content</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">c</span><span class="o">.</span><span class="n">Body</span><span class="o">.</span><span class="n">Bytes</span><span class="p">()</span><span class="x">

			</span><span class="k">if</span><span class="x"> </span><span class="n">d</span><span class="p">,</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">time</span><span class="o">.</span><span class="n">ParseDuration</span><span class="p">(</span><span class="n">duration</span><span class="p">);</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">==</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
				</span><span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"New page cached: %s for %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="x"> </span><span class="n">r</span><span class="o">.</span><span class="n">RequestURI</span><span class="p">,</span><span class="x"> </span><span class="n">duration</span><span class="p">)</span><span class="x">
				</span><span class="n">storage</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">RequestURI</span><span class="p">,</span><span class="x"> </span><span class="n">content</span><span class="p">,</span><span class="x"> </span><span class="n">d</span><span class="p">)</span><span class="x">
			</span><span class="p">}</span><span class="x"> </span><span class="k">else</span><span class="x"> </span><span class="p">{</span><span class="x">
				</span><span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"Page not cached. err: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="x"> </span><span class="n">err</span><span class="p">)</span><span class="x">
			</span><span class="p">}</span><span class="x">

			</span><span class="n">w</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span><span class="x">
		</span><span class="p">}</span><span class="x">

	</span><span class="p">})</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre></div></div>

<p>Para us√°-lo √© necess√°rio encapsular a chamada ao HTTP handler dentro da chamada √† func√£o <code class="highlighter-rouge">cached</code>. Gra√ßas ao pacote <code class="highlighter-rouge">time</code> do Go, podemos usar uma string f√°cil de ler para representar a dura√ß√£o total do cache. Por exemplo, <code class="highlighter-rouge">10s</code> √© muito mais f√°cil de entender do que <code class="highlighter-rouge">10 * 1000</code>. No exemplo a seguir, apenas o HTTP handler index √© que est√° sendo cacheado.</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// tanto index qaunto about s√£o: func (w http.ResponseWriter, r *http.Request) { ... }</span><span class="x">
</span><span class="n">http</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span><span class="x"> </span><span class="n">cached</span><span class="p">(</span><span class="s">"10s"</span><span class="p">,</span><span class="x"> </span><span class="n">index</span><span class="p">))</span><span class="x"> 
</span><span class="n">http</span><span class="o">.</span><span class="n">HandleFunc</span><span class="p">(</span><span class="s">"/about"</span><span class="p">,</span><span class="x"> </span><span class="n">about</span><span class="p">)</span><span class="x">
</span><span class="n">http</span><span class="o">.</span><span class="n">ListenAndServe</span><span class="p">(</span><span class="o">...</span><span class="p">)</span><span class="x">
</span></code></pre></div></div>

<p>Veja se seguintes images de duas requisi√ß√µes subsequentes ao mesmo endere√ßo.</p>

<p>A primeira requisi√ß√£o demora <strong>2 segundos</strong> enquanto a segunda apenas <strong>27ms</strong>. A resposta possui o <strong>mesmo conte√∫do e tamanho</strong>.</p>

<p><img src="/public/images/2017/03/load-one.png" alt="" /></p>

<p><img src="/public/images/2017/03/load-two.png" alt="" /></p>

<p>10 segundos ap√≥s a primeira requisi√ß√£o, o cache √© removido e a pr√≥xima requisi√ß√£o novamente demorar√° 2 segundos.</p>

<h3 id="o-que-voc√™-deve-tomar-cuidado-quando-estiver-implementando-cache-no-lado-do-servidor">O que voc√™ deve tomar cuidado quando estiver implementando cache no lado do servidor</h3>

<p>O primeiro passo √© <strong>nuncan</strong> fazer cache de requisi√ß√µes POST, PUT ou DELETE, afinal estas opera√ß√£o s√£o usadas para alterar dados e n√£o retornar, por isto n√£o faz sentido fazer cache disto. Dito isto, apenas requisi√ß√µes GET devem ser cacheadas. <strong>Dica</strong>: √© poss√≠vel implementar algumas valida√ß√µes no middleware para evitar enganos como este :)</p>

<p>Tome um cuidado extra com conte√∫do baseado no usu√°rio autenticado. Aplica√ß√µes e sites que possuiem op√ß√£o de autentica√ß√£o tamb√©m podem ser cacheadas, por√©m um cuidado extra deve ser tomado para que a chave de identifica√ß√£o do usu√°rio tamb√©m deve fazer parte da chave do cache, caso contr√°rio sua aplica√ß√£o retornar√° o conte√∫do de um usu√°rio para outro, o que seria um grande vazamento de dados. A desvantagem aqui √© a quantidade de p√°ginas a ser cacheadas ser√° bem maior, tenha isto em mente!</p>

<p>Outra sugest√£o √© implementar alguma forma que seja f√°cil de desativar o cache, pois isto pode ser bem incoveniente durante o desenvolvimento.</p>

<h3 id="parab√©ns-">Parab√©ns üéâ</h3>

<p>Voc√™ acaba de aprender como fazer da web um lugar melhor para todos n√≥s. Agora voc√™ j√° sabe como fazer algo r√°pido ficar ainda mais r√°pido!</p>

<p>Um abra√ßo!</p>

  </div>
  <a href="https://twitter.com/intent/tweet?text=Cache+no+Servidor+com+Go+by+@goenning&url=https%3A%2F%2Fgoenning.net%2F2017%2F03%2F18%2Fcache-no-servidor-com-go%2F">Discuss on Twitter</a> <small>‚Ä¢</small> <a href="https://github.com/goenning/goenning.github.io/tree/master/_posts/2017/2017-03-18-cache-no-servidor-com-go.md">Edit on GitHub</a>
</article>

    </div>

    <div class="wrapper-footer">
      <div class="container">
        <footer class="footer">
          <a href="mailto:me@goenning.net" aria-label="Email" target="_blank" rel="noopener"><i class="svg-icon email"></i></a>
<a href="https://github.com/goenning" aria-label="GitHub" target="_blank" rel="noopener"><i class="svg-icon github"></i></a>
<a href="https://www.linkedin.com/in/goenning" aria-label="LinkedIn" target="_blank" rel="noopener"><i class="svg-icon linkedin"></i></a>
<a href="/feed.xml" aria-label="RSS Feed" target="_blank" rel="noopener"><i class="svg-icon rss"></i></a>
<a href="https://www.twitter.com/goenning" aria-label="Twitter" target="_blank" rel="noopener"><i class="svg-icon twitter"></i></a>




        </footer>
      </div>
    </div>
  </body>
</html>
